<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 基于ChatBot的运维通知和管理 · Notebook</title><meta name="description" content="基于ChatBot的运维通知和管理 - Simon Ren"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Notebook"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Notebook" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">基于ChatBot的运维通知和管理</h1><div class="post-info">May 24, 2018</div><div class="post-content"><h3 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h3><p>越来越及时高效的运维监控管理要求，传统的邮件已经无法满足，基于各种聊天工具的BotAPI也日趋流行。钉钉 <a target="_blank" rel="noopener" href="https://www.dingtalk.com/">https://www.dingtalk.com</a> 和Telegram <a target="_blank" rel="noopener" href="https://telegram.org/">https://telegram.org</a> 都有着不错的BOT接口。</p>
<h3 id="钉钉接入"><a href="#钉钉接入" class="headerlink" title="钉钉接入"></a>钉钉接入</h3><p>钉钉自定义机器人接入文档地址：<br><a target="_blank" rel="noopener" href="https://open-doc.dingtalk.com/docs/doc.htm?treeId=257&amp;articleId=105735&amp;docType=1">https://open-doc.dingtalk.com/docs/doc.htm?treeId=257&amp;articleId=105735&amp;docType=1</a></p>
<p>运维的后台系统可以通过向申请到的消息URL发送POST请求，来将数据发送到钉钉群，并且可以@到特定群成员，让老板开心，让责任人无法回避…<br>自定义机器人接口支持部分MD语法，可以做到不错的显示效果。可惜的是不支持应答机制，无法向机器人发送消息完成后端业务逻辑，期待钉钉更新。</p>
<h3 id="Telegram接入"><a href="#Telegram接入" class="headerlink" title="Telegram接入"></a>Telegram接入</h3><p>Telegram Bot API介绍地址:<br><a target="_blank" rel="noopener" href="https://core.telegram.org/bots">https://core.telegram.org/bots</a></p>
<p>相比而言Telegram Bot就显得比较牛逼了，还可以做H5的游戏在里面玩，实在是居家旅行，杀人灭口……</p>
<h4 id="申请Bot"><a href="#申请Bot" class="headerlink" title="申请Bot"></a>申请Bot</h4><p>在Telegram里面添加BotFather机器人，会出现机器人之父的大量控制说明，直接发送<code>/newbot</code>就开始创建机器人了。<br>选好用户名创建好Bot后，BotFather会给你一个token，记录下来，这就是控制机器人的唯一标识了。当然，也可以随时通过<code>/mybots</code>来查询目标机器人的token。</p>
<h4 id="使用Bot"><a href="#使用Bot" class="headerlink" title="使用Bot"></a>使用Bot</h4><p>Telegram Bot功能众多，使用SDK来接入是最好的方式。官方在<a target="_blank" rel="noopener" href="https://core.telegram.org/bots/samples">https://core.telegram.org/bots/samples</a>提供了大量的SDK地址和示例地址可供参考。<br>SDK In Python <a target="_blank" rel="noopener" href="https://github.com/python-telegram-bot/python-telegram-bot">https://github.com/python-telegram-bot/python-telegram-bot</a><br>SDK In Lua <a target="_blank" rel="noopener" href="https://github.com/wrxck/telegram-bot-lua">https://github.com/wrxck/telegram-bot-lua</a></p>
<p>SDK接入后就可以发消息，收消息，处理事务逻辑了。<br>每一条消息都会有对应发送者的ID传过来，对ID进行授权管理，加入密码验证，时效验证，即可成为一个安全可靠的运维运营控制台。<br>密码验证可以考虑Google Authenticator动态码，简单有效不怕暴力破解。<br>Library In Python <a target="_blank" rel="noopener" href="https://github.com/pyotp/pyotp">https://github.com/pyotp/pyotp</a><br>Library In Lua <a target="_blank" rel="noopener" href="https://github.com/imzyxwvu/lua-gauth">https://github.com/imzyxwvu/lua-gauth</a></p>
<span id="more"></span>
</div></article></div></main><footer><div class="paginator"><a href="/2018/05/25/HAProxy/" class="prev">上一篇</a><a href="/2018/05/24/Caddy/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2022 <a href="http://yoursite.com">Simon Ren</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>